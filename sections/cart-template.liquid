<div class="container" data-section-id="{{ section.id }}" data-section-type="cart-template" style="margin-top:40px;">

  {% if cart.item_count > 0 %}
    <div class="section-header text-center">
      <h1 class="h5" style="margin-bottom:30px;">CART</h1>
    </div>


    <form action="/cart" method="post" novalidate class="cart">
        	<div class="row">
              <div class="col-md-40 col-60">
      <table>
        <thead class="cart__row cart__header">
          <th colspan="2">{{ 'cart.label.product' | t }}</th>
          <th>{{ 'cart.label.price' | t }}</th>
          <th class="text-center">{{ 'cart.label.quantity' | t }}</th>
          <th class="text-right">{{ 'cart.label.total' | t }}</th>
        </thead>
        <tbody>
          {% for item in cart.items %}
            {% assign has_script_price = false %}
            {% for property in item.properties %}
              {% if property.first == '_script_price'%}
          	    {% assign has_script_price = true %}
                {% assign script_price = property.last | times: 1 %}
                {% assign script_line_price = property.last | times: 1 | times: item.quantity %}
              {% endif %}
              {% if property.first == '_bundle_key'%}
                {% assign bundle_key = property.last %}
              {% endif %}
            {% endfor %}
            <tr class="cart__row border-bottom line{{ forloop.index }} cart-flex{% if forloop.first %} border-top{% endif %}">
              <td class="cart__image-wrapper">
                <a href="{{ item.url | within: collections.all }}">
                  {% include 'image', class:'cart__image', file: item, default_size: '100x', alt: item.title | escape %}
                </a>
              </td>
              <td class="cart__meta small--text-left">
                <div class="list-view-item__title">
                  <a href="{{ item.url }}">
                    {{ item.product.title }}
                    {% if item.quantity > 1 %}
                      <span class="hidden-md-up"><span class="visually-hidden">{{ 'cart.label.quantity' | t }}</span>(x{{ item.quantity }})</span>
                    {% endif %}
                  </a>
                </div>
                {% unless item.variant.title contains 'Default' %}
                  <div class="cart__meta-text">
                    {% for option in item.product.options %}
                      {{ option }}: {{ item.variant.options[forloop.index0] }}</br>
                    {% endfor %}
                  </div>
                {% endunless %}

                {% comment %}
                  Optional, loop through custom product line items if available

                  Line item properties come in as having two parts. The first part will be passed with the default form,
                  but p.last is the actual custom property and may be blank. If it is, don't show it.

                  For more info on line item properties, visit:
                    - http://docs.shopify.com/support/your-store/products/how-do-I-collect-additional-information-on-the-product-page-Like-for-a-monogram-engraving-or-customization
                {% endcomment %}
                {%- assign property_size = item.properties | size -%}
                {% if property_size > 0 %}
                  <div class="cart__meta-text">
                    {% for p in item.properties %}
                      {% unless p.last == blank or p.first contains '_' %}
                        {{ p.first }}:

                        {% comment %}
                          Check if there was an uploaded file associated
                        {% endcomment %}
                        {% if p.last contains '/uploads/' %}
                          <a href="{{ p.last }}">{{ p.last | split: '/' | last }}</a>
                        {% else %}
                          {{ p.last }}
                        {% endif %}
                      {% endunless %}
                    {% endfor %}
                  </div>
                {% endif %}

                <p class="hidden-sm-down">
                  {% unless has_script_price %}
                  <a href="/cart/change?line={{ forloop.index }}&amp;quantity=0" class="btn btn--small btn--secondary cart__remove">{{ 'cart.general.remove' | t }}</a>
                  {% endunless %}
                </p>
              </td>
              <td class="cart__price-wrapper">
                {% if has_script_price %}
                <s>{{ item.product.price | money }}</s><br />
                {% else %}
                {% endif %}
                  {{ item.price | money }}
                {% for discount in item.discounts %}
                  {% if has_script_price == false %}
                  <div class="cart-item__discount hidden-md-up">{{ discount.title }}</div>
                  {% endif %}
                {% endfor %}

              </td>
              <td class="cart__update-wrapper text-right">
                <div class="cart__qty">
                  <label for="updates_{{ item.key }}" class="cart__qty-label">{{ 'cart.label.quantity' | t }}</label>
                  <input class="cart__qty-input" type="number" name="updates[]" id="updates_{{ item.key }}" value="{{ item.quantity }}" min="0" pattern="[0-9]*" {% if has_script_price %}data-bundle-key="{{ bundle_key }}"{% endif %}>
                </div>
                <input type="submit" name="update" class="btn btn--small cart__update hidden-md-up" value="{{ 'cart.general.update' | t }}">
              </td>
              <td class="text-right hidden-sm-down price">
                {% if item.original_line_price != item.line_price %}
                  <div class="cart-item__original-price"><s>{{ item.original_line_price | money }}</s></div>
                {% endif %}

                <div>
                {% if has_script_price %}
                {% else %}
                {% endif %}    
                  {{ item.line_price | money }}
                </div>

                {% for discount in item.discounts %}
                  <div class="cart-item__discount">{{ discount.title }}</div>
                {% endfor %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
</div>
<div class="col-md-20 col-60">
      <footer class="container cart__footer" style="    background: #f7f7f7;
    padding: 20px;">
        <div class="row">
          {% if section.settings.cart_notes_enable %}
            <div class="col-md-30 cart-note">
              <label for="CartSpecialInstructions" class="cart-note__label small--text-center">{{ 'cart.general.note' | t }}</label>
              <textarea name="note" id="CartSpecialInstructions" class="cart-note__input">{{ cart.note }}</textarea>
            </div>
          {% endif %}
          <div class="text-right small--text-center{% if section.settings.cart_notes_enable %} col-md-30{% else %} col{% endif %}">
            <div>
              <span class="cart__subtotal-title">{{ 'cart.general.subtotal' | t }}</span>
              <span class="cart__subtotal">{{ cart.total_price | money }}</span>
            </div>
            {% if cart.total_discounts > 0 %}
              <div class="cart__savings">
                {{ 'cart.general.savings' | t }}
                <span class="cart__savings-amount">{{ cart.total_discounts | money }}</span>
              </div>
            {% endif %}
            <div class="klarna-display"></div>
            <div class="cart__shipping">{{ 'cart.general.shipping_at_checkout' | t }}</div>
            <input style="width:100%;    color: #262626;
    background-color: #DBB7BB;" type="submit" name="checkout" class="btn btn--small-wide" value="{{ 'cart.general.checkout' | t }}">
            {% if additional_checkout_buttons %}
              <div class="additional-checkout-buttons">{{ content_for_additional_checkout_buttons }}</div>
            {% endif %}
          </div>
        </div>
      </footer>
</div>
</div>
    </form>
  {% else %}
    <div class="empty-page-content text-center">
      <h1>{{ 'cart.general.title' | t }}</h1>
      <p>{{ 'cart.general.empty' | t }}</p>
      <a href="/" class="btn btn--has-icon-after">{{ 'general.404.link' | t }}{% include 'icon-arrow-right' %}</a>
    </div>
  {% endif %}
</div>

<script>
  $(document).ready(function() {
    $('.cart__qty-input[data-bundle-key]').on('change',function() {
      var qtyInt = parseInt($(this).val());
      var bundleKey = $(this).data('bundle-key');
      console.log('new qty: '+qtyInt);
      $('.cart__qty-input[data-bundle-key="'+bundleKey+'"]').val(qtyInt);
    });
  });
</script>

{% schema %}
  {
    "name": "Cart page",
    "settings": [
      {
        "type": "checkbox",
        "id": "cart_notes_enable",
        "label": "Enable cart notes",
        "default": false
      }
    ]
  }
{% endschema %}